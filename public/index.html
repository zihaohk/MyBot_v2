<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>情感聊天机器人</title>
  <link rel="icon" type="image/png" href="/sanhua.png" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="no-panel-anim">
  <div class="app">
    <header class="topbar">
      <button id="btnSettings" class="icon-btn" title="设置">⚙</button>
      <div class="topbar-title">
        <div class="title">情感聊天机器人</div>
        <div class="subtitle" id="subtitle">就绪</div>
      </div>
      <div class="topbar-actions">
        <button id="btnPersona" class="btn">人设</button>
        <button id="btnMemory" class="btn">记忆</button>
      </div>
    </header>

    <main class="main">
      <section class="chat">
        <div id="emptyState" class="empty-state hidden">选择一个心仪的对象开始聊天吧...</div>
        <div id="chatList" class="chat-list"></div>
      </section>
      <button id="personaToggle" class="panel-toggle" type="button" aria-label="Toggle persona panel">&gt;</button>
      <aside class="persona-panel">
        <div class="persona-header">
          <div class="persona-title">角色列表</div>
          <div class="persona-actions">
            <button id="btnNewPersona" class="btn">新建</button>
            <button id="btnDeletePersona" class="btn danger">删除</button>
          </div>
        </div>
        <div id="personaList" class="persona-list"></div>
      </aside>
    </main>

    <footer id="composer" class="composer">
      <textarea id="input" class="input" rows="2" placeholder="输入消息…（Enter 发送，Shift+Enter 换行）"></textarea>
      <button id="btnSend" class="btn primary">
        <span class="btn-text">发送</span>
        <span class="spinner hidden" aria-hidden="true"></span>
      </button>
    </footer>
  </div>

  <!-- Settings Modal -->
  <div id="modalSettings" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title">设置</div>
        <button class="icon-btn" data-close="modalSettings">✕</button>
      </div>
      <div class="modal-body">
        <div class="settings-grid">
          <div class="settings-col">
        <label class="field">
          <div class="label">保存记忆轮数</div>
          <input id="memoryTurnsInput" type="number" min="1" max="200" step="1" />
        </label>
        <label class="field">
          <div class="label">Temperature (0-2)</div>
          <input id="temperatureInput" type="number" min="0" max="2" step="0.1" />
        </label>
        <label class="field">
          <div class="label">Top-p (0-1)</div>
          <input id="topPInput" type="number" min="0" max="1" step="0.05" />
        </label>
        <label class="field">
          <div class="label">发送延迟(ms)</div>
          <input id="sendDelayInput" type="number" min="0" max="60000" step="100" />
        </label>
        <label class="field">
          <div class="label">Assistant segment delay (ms)</div>
          <input id="assistantSegmentDelayInput" type="number" min="0" max="60000" step="100" />
        </label>
        <label class="field">
          <div class="label">Max tokens</div>
          <input id="maxTokensInput" type="number" min="1" max="200000" step="1" />
        </label>
          </div>
          <div class="settings-col">
            <label class="field">
          <div class="label">Font</div>
          <select id="fontFamilySelect">
            <option value="system">System</option>
            <option value="pingfang">PingFang</option>
            <option value="yahei">YaHei</option>
            <option value="noto">Noto Sans</option>
            <option value="song">Songti</option>
            <option value="kaiti">Kaiti</option>
            <option value="fangsong">FangSong</option>
            <option value="mono">Monospace</option>
          </select>
        </label>
          </div>
        </div>
        <div id="settingsError" class="error-hint hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" data-close="modalSettings">取消</button>
        <button id="btnSaveSettings" class="btn primary">保存</button>
      </div>
    </div>
  </div>

  <!-- Persona Modal -->
  <div id="modalPersona" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card large">
      <div class="modal-header">
        <div class="modal-title">人设（persona.md）</div>
        <button class="icon-btn" data-close="modalPersona">✕</button>
      </div>
      <div class="modal-body">
        <textarea id="personaEditor" class="editor" spellcheck="false"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn" id="btnReloadPersona">重新加载</button>
        <button class="btn" data-close="modalPersona">关闭</button>
        <button class="btn primary" id="btnSavePersona">保存</button>
      </div>
    </div>
  </div>

  <!-- Memory Modal -->
  <div id="modalMemory" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card large">
      <div class="modal-header">
        <div class="modal-title">记忆（memory.json）</div>
        <button class="icon-btn" data-close="modalMemory">✕</button>
      </div>
      <div class="modal-body">
        <textarea id="memoryEditor" class="editor" spellcheck="false"></textarea>
        <div class="hint">注意：必须是合法 JSON。保存后将按设置的轮数自动裁剪。</div>
      </div>
      <div class="modal-footer memory-footer">
        <div class="footer-left">
          <button class="btn danger" id="btnClearMemory">清空</button>
        </div>
        <div class="footer-right">
          <button class="btn" id="btnReloadMemory">重新加载</button>
          <button class="btn" data-close="modalMemory">关闭</button>
          <button class="btn primary" id="btnSaveMemory">保存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Persona Modal -->
  <div id="modalCreatePersona" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title">新建人设</div>
        <button class="icon-btn" data-close="modalCreatePersona">✕</button>
      </div>
      <div class="modal-body">
        <label class="field">
          <div class="label">文件夹名</div>
          <input id="personaIdInput" type="text" autocomplete="off" />
          <div class="hint">仅支持字母、数字、下划线、短横线</div>
        </label>
        <label class="field">
          <div class="label">角色名</div>
          <input id="personaNameInput" type="text" autocomplete="off" />
        </label>
        <div id="personaCreateError" class="error-hint hidden"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" data-close="modalCreatePersona">取消</button>
        <button id="btnCreatePersona" class="btn primary">创建</button>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>
